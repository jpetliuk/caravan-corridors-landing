---
import '../styles/global.css';

interface Props {
	title?: string;
}

const { title = "Caravan Corridors Database - Archaeological Data Standard" } = Astro.props;
---

<!doctype html>
<html lang="en" class="scroll-smooth">
	<head>
		<meta charset="UTF-8" />
		<meta name="description" content="Caravan Field Recorder - The Offline-First Digital Field Recorder for Modern Archaeology" />
		<meta name="viewport" content="width=device-width" />
		<link rel="icon" type="image/svg+xml" href="/favicon.svg" />
		<meta name="generator" content={Astro.generator} />
		<link rel="preconnect" href="https://fonts.googleapis.com">
		<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
		<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
		<title>{title}</title>
	</head>
	<body class="bg-slate-50 text-slate-900 font-sans antialiased overflow-x-hidden selection:bg-indigo-500 selection:text-white">
		<slot />
        <script>
            import Lenis from 'lenis';

            // Initialize Lenis for premium smooth scrolling
            const lenis = new Lenis({
                duration: 1.2, // The "Goldilocks" zone: Premium weight, but responsive
                easing: (t) => Math.min(1, 1.001 - Math.pow(2, -10 * t)),
                orientation: 'vertical',
                gestureOrientation: 'vertical',
                smoothWheel: true,
                wheelMultiplier: 1, // standard 1:1 response (feels faster)
                touchMultiplier: 2,
            });

            function raf(time) {
                lenis.raf(time);
                requestAnimationFrame(raf);
            }

            requestAnimationFrame(raf);

            // Handle anchor links with Lenis
            document.querySelectorAll('a[href^="#"]').forEach(anchor => {
                anchor.addEventListener('click', function (e) {
                    e.preventDefault();
                    // Get target
                    const targetId = this.getAttribute('href');
                    if(targetId === '#') return;
                    
                    const targetElement = document.querySelector(targetId);
                    
                    if (targetElement) {
                        lenis.scrollTo(targetElement, {
                            offset: 0,
                            duration: 1.5 // Slightly slower than scroll for cinematic effect, but not 3s
                        });
                        // update URL without jump
                        history.pushState(null, null, targetId);
                    }
                });
            });

            // Existing Intersection Observer for fade-ins
            const observerOptions = {
                root: null,
                rootMargin: '0px',
                threshold: 0.1
            };

            const observer = new IntersectionObserver((entries, observer) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.classList.add('is-visible');
                        observer.unobserve(entry.target); // Only animate once
                    }
                });
            }, observerOptions);

            document.addEventListener('DOMContentLoaded', () => {
                const sections = document.querySelectorAll('.fade-in-section');
                sections.forEach(section => {
                    observer.observe(section);
                });
            });
        </script>
	</body>
</html>

<style is:global>
	:root {
		--font-sans: 'Inter', sans-serif;
	}
	html {
		font-family: var(--font-sans);
        background-color: #f8fafc; /* slate-50 */
        background-image: linear-gradient(to right, rgba(99, 102, 241, 0.05) 1px, transparent 1px),
                          linear-gradient(to bottom, rgba(99, 102, 241, 0.05) 1px, transparent 1px);
        background-size: 40px 40px;
	}

    /* Animation Utilities */
    .lenis.lenis-smooth {
        scroll-behavior: auto !important;
    }
    .lenis.lenis-smooth [data-lenis-prevent] {
        overscroll-behavior: contain;
    }
    .lenis.lenis-stopped {
        overflow: hidden;
    }
    .lenis.lenis-scrolling iframe {
        pointer-events: none;
    }
    .fade-in-section {
        opacity: 0;
        transform: translateY(20px);
        transition: opacity 0.8s ease-out, transform 0.8s ease-out;
        will-change: opacity, visibility;
    }
    .fade-in-section.is-visible {
        opacity: 1;
        transform: none;
    }
    
    .delay-100 { transition-delay: 100ms; }
    .delay-200 { transition-delay: 200ms; }
    .delay-300 { transition-delay: 300ms; }
</style>
